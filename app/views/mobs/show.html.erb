<div class="container">
  <%= render 'shared/dashboard' %>
  <% if @player.health <= 0 %>
    Votre santÃ© est Ã  O
  <% elsif Place.find_by(name: @player.position) != @place && @player.in_fight_mob == @mob.name && @mob.name != 'Rois des Mers' && @mob.condition != "Marine" %>
    <% @player.update(in_fight: false) %>
    <% @player.update(in_fight_mob: "") %>
    <% @player.update(player_power: 0) %>
    <% FightToken.where(player: @player).last.destroy %>
    <%= link_to 'retour', place_path(Place.find_by(name: @player.position)), class: "btn btn-success" %>
  <% elsif Place.find_by(name: @player.position) == @place && @mob.condition != nil && !(@mob.condition.split("/") - @player.defeated_mob).empty? %>
    <% @player.update(in_fight: false) %>
    <% @player.update(in_fight_mob: "") %>
    <% @player.update(player_power: 0) %>
    <% FightToken.where(player: @player).last.destroy %>
    <%= link_to 'retour', place_path(Place.find_by(name: @player.position)), class: "btn btn-success" %>
  <% elsif @mob.condition != nil && !(@mob.condition.split("/") - @player.defeated_mob).empty? %>
    <%= link_to 'Vous Ãªtes dÃ©ja en combat ici âš”ï¸', mob_path(Mob.find_by(name: @player.in_fight_mob)) %>
  <% elsif @player.in_fight_enemy == "" && @player.in_fight_mob != @mob.name %>
    <%= link_to 'Vous Ãªtes dÃ©ja en combat ici âš”ï¸', mob_path(Mob.find_by(name: @player.in_fight_mob)) %>
  <% elsif @player.in_fight_enemy != "" && @player.fight != "attacked" %>
    <%= link_to 'Vous Ãªtes en combat ici âš”ï¸', player_pvp_path(Player.find_by(user: User.find_by(pseudo: @player.in_fight_enemy))) %>
  <% elsif @player.in_fight_enemy != "" && @player.fight == "attacked"  %>
    Vous Ãªtes actuellement attaquÃ© par <%= User.find_by(pseudo: @player.in_fight_enemy).pseudo %> (rÃ©sultat dans 2min max)
  <% else %>
  <h1 class="font-custom text-center  "> <%= @place.name %>
  </h1>
    <% if @player.health <= 0 %>
    Perdu!  Vous devez attendre de rÃ©cupÃ©rer de la santÃ© (santÃ© maximum rÃ©cupÃ©rÃ©e chaque jour)
        <%= link_to 'retour', place_path(@mob.place_id), class: "btn btn-success" %>
    <% else %>
      <div class="m-3 d-flex">
        <div class="card col-6 col-md-6 mx-2">
        <h2>Votre Puissance D'AttaqueğŸ—¡ï¸: <%= @player.player_power %></h2>
        <div class="progress">
          <div class="progress-bar" role="progressbar" style="width: 100%" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100">de 0 Ã  20 <%= 'ğŸ—¡ï¸' if @player.player_power < 21 %></div>
          <div class="progress-bar bg-success" role="progressbar" style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">21 Parfait! <%= 'ğŸ—¡ï¸' if @player.player_power == 21 %> </div>
          <div class="progress-bar bg-danger" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="90" aria-valuemax="100"> >21 Perdu <%= 'ğŸ—¡ï¸' if @player.player_power > 21 %></div>
        </div>
        <br>
          Ã©cart de niveau: + <%= @player.level - @mob.level %> Ã  la rÃ©solution du combat
          <br>
          Ã©cart des bonus: + <%= @sum %> Ã  la rÃ©solution du combat
          <br>
          <h2> ATTAQUE TOTALE: +<%=@player.player_power + @player.level - @mob.level + @sum %></h2>
          <br>
          <% if @player.player_power == 0 %>
           <%= button_to 'Attaquer (+1 Ã  +11)',mob_power_path(@mob), method: :post %>
          <% elsif @player.fight == 'lose' %>
            Perdu!
            <%= button_to 'Continuer?', mob_retry_player_path(@mob), method: :post,data: { disable_with: "Continuer?" } %> ou <%= button_to 'Fuir?',mob_run_path(@mob), method: :post,data: { disable_with: "Fuir" } %>
    1 blessure
          <% elsif @player.player_power == 21%>
            Puissance Maximale!
            <%= button_to 'RÃ©soudre le combat', mob_resolve_path(@mob) , method: :post, data: { disable_with: "RÃ©soudre" } %> ou <%= button_to 'Fuir?',mob_run_path(@mob), method: :post %>
          <% elsif @player.player_power < 21 %>
            <%= button_to 'Attaquer (+1 Ã  +11)',mob_power_path(@mob), method: :post %>
            ou
            <%= button_to 'RÃ©soudre le combat', mob_resolve_path(@mob) , method: :post, data: { disable_with: "RÃ©soudre" } %>
            ou <%= button_to 'Fuir?',mob_run_path(@mob), method: :post,data: { disable_with: "fuir" } %>
          <% end %>
          <br>
          <ul>
          Bonus: <% @player.rewards.where(statut: "Ã©quipÃ©").each do |reward| %>
            <li> <%= reward.category %>: <%= reward.name %> <%= image_tag reward.image , :class => "avatar-large" %>
 </li>
          <% end %>
          </ul>
          <br>
          Vous avez 10 minutes pour finir ce combat.
       </div>
        <div class="card col-6 col-md-6  mx-2">
              <h1><%= @mob.name %>: Puissance D'AttaqueğŸ—¡ï¸ <%= @player.mob_power %>  </h1>
              <%= image_tag @mob.image , :class => "product-photo center mt-3" %>
               LVL:<%= @mob.level %>ğŸ’ª SantÃ©:<%= @player.mob_health %>/<%= @mob.health %>â¤ï¸ Bonus: <%= @mob.bonus %> ğŸˆ
        </div>
      </div>
    <% end %>
  <% end %>
</div>



